# xgboost
æœ€ç»ˆé¢„æµ‹:
$$
\hat{y}_i = \sum_{k=1}^{K}f_{k}(x_i)
$$
å…¶ä¸­$x_i$ä¸ºç¬¬$i$ä¸ªæ ·æœ¬ï¼Œ$\hat{y}_i$ä¸ºé¢„æµ‹å€¼ï¼Œ$k$ä¸ºæ ‘çš„ç´¢å¼•ï¼Œ$f_k$ä¸ºç¬¬$k$é¢—æ ‘é¢„æµ‹ï¼Œå®šä¹‰lossä¸º
$$\text{obj}^{(t)} = \sum_{i=1}^n {l(y_i, \hat{y}_i^t)} + \sum_{i=1}^t{\Omega(f_i)}$$
å…¶ä¸­$\Omega$ä¸ºæ ‘çš„å¤æ‚åº¦ï¼Œæ˜¯æ­£åˆ™åŒ–é¡¹é˜²æ­¢è¿‡æ‹Ÿåˆã€‚åˆå› ä¸ºå¯¹ç¬¬$t$é¢—æ ‘æ¥è¯´ï¼Œå‰é¢çš„æ ‘å·²ç»å›ºå®šï¼Œå› æ­¤
$$\text{obj}^{(t)} = \sum_{i=1}^n{l(y_i, \hat{y}_i^{(t-1)}+f_t(x_i))} + \Omega(f_t) + \text{constant}$$
è¿›è¡Œæ³°å‹’çº§æ•°å±•å¼€
$$\text{obj}^{(t)} = \sum_{i=1}^n [l(y_i, \hat{y}_i^{(t-1)}) + g_i f_t(x_i) + \frac{1}{2} h_i f_t^2(x_i)] + \Omega(f_t) + \mathrm{constant}$$
å…¶ä¸­
$$
\begin{aligned}g_i &= \partial_{\hat{y}_i^{(t-1)}} l(y_i, \hat{y}_i^{(t-1)})\\
h_i &= \partial_{\hat{y}_i^{(t-1)}}^2 l(y_i, \hat{y}_i^{(t-1)})\end{aligned}
$$
ç”±äºå¯¹ç¬¬$t$é¢—æ ‘æ¥è¯´ï¼Œå‰é¢çš„æ ‘å·²ç»å›ºå®šï¼Œå› æ­¤$l(y_i, \hat{y}_i^{(t-1)})$ä¹Ÿä¸ºå¸¸æ•°é¡¹ï¼Œå»æ‰å¸¸æ•°é¡¹åï¼š
$$\text{obj}^{(t)} = \sum_{i=1}^n [g_i f_t(x_i) + \frac{1}{2} h_i f_t^2(x_i)] + \Omega(f_t)$$
ç”±äºå¯¹CARTæ ‘æ¥è¯´ï¼Œä»»ä¸€è¾“å…¥éƒ½å¯¹åº”ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå› æ­¤å¯ä»¥å®šä¹‰ä¸ºï¼š
$$f_t(x) = w_{q(x)}, w \in R^T, q:R^d\rightarrow \{1,2,\cdots,T\} .$$
å…¶ä¸­$w$æ˜¯æ ‘å¶çš„æƒé‡ï¼ŒæŠŠ$T$ä¸ªå¶å­ç¼–ç æˆ$1,2,\cdots,ğ‘‡$ï¼Œå¯¹åº”çš„æƒé‡æ˜¯$ğ‘¤_1,ğ‘¤_2,\cdots,ğ‘¤_ğ‘‡$ã€‚è€Œå‡½æ•°$q(x)$æ˜¯å†³ç­–å‡½æ•°ï¼Œå®ƒæŠŠè¾“å…¥$ğ‘¥\inğ‘…_ğ‘‘$æ˜ å°„éƒ½æŸä¸ªå¶å­(çš„ä¸‹æ ‡)ã€‚

å¯ä»¥å®šä¹‰CARTæ ‘çš„å¤æ‚åº¦ä¸ºï¼š
$$\Omega(f) = \gamma T + \frac{1}{2}\lambda \sum_{j=1}^T w_j^2$$
æ ¹æ®ä¸Šé¢çš„å®šä¹‰ï¼Œæ ‘çš„å¶å­è¶Šå¤š(ä»è€ŒèŠ‚ç‚¹ä¹Ÿè¶Šå¤šï¼Œå› ä¸ºèŠ‚ç‚¹ä¸ªæ•°=2*å¶å­æ•°-1)ï¼Œå¤æ‚åº¦è¶Šé«˜ï¼Œæ­¤å¤–æƒé‡è¶Šå¤§ä¹Ÿè¶Šå¤æ‚ï¼Œå‚æ•°$\lambda$ç”¨æ¥æ§åˆ¶è¿™ä¸¤è€…çš„æ¯”é‡ã€‚

å¸¦å…¥å¾—æŸå¤±å‡½æ•°ä¸ºï¼š
$$
\begin{aligned}\text{obj}^{(t)} &= \sum_{i=1}^n [g_i w_{q(x_i)} + \frac{1}{2} h_i w_{q(x_i)}^2] + \gamma T + \frac{1}{2}\lambda \sum_{j=1}^T w_j^2\\
&= \sum^T_{j=1} [(\sum_{i\in I_j} g_i) w_j + \frac{1}{2} (\sum_{i\in I_j} h_i + \lambda) w_j^2 ] + \gamma T\end{aligned} 
$$
å…¶ä¸­$I_j = \{i | q(x_i)=j \}$ï¼Œè¡¨ç¤ºè½åˆ°èŠ‚ç‚¹$j$çš„æ ·æœ¬$i$ç»„æˆçš„é›†åˆï¼Œå®šä¹‰
$$G_j = \sum_{i\in I_j} g_i \\ 
H_j = \sum_{i\in I_j} h_i
$$
åˆ™$G_j$è¡¨ç¤ºæ‰€æœ‰è½åˆ°èŠ‚ç‚¹$j$çš„å¯¼æ•°ä¹‹å’Œï¼Œ$H_j$æ˜¯äºŒé˜¶å¯¼æ•°ä¹‹å’Œã€‚$G$å’Œ$H$åªä¾èµ–äºæ ‘çš„ç»“æ„$q$ï¼Œè€Œä¸ä¾èµ–äºèŠ‚ç‚¹çš„æƒé‡$w$ï¼ŒæŸå¤±å‡½æ•°è¿›ä¸€æ­¥åŒ–ç®€ä¸º
$$
\text{obj}^{(t)} = \sum^T_{j=1} [G_jw_j + \frac{1}{2} (H_j+\lambda) w_j^2] +\gamma T$$

å‡è®¾æ ‘çš„ç»“æ„æ˜¯å›ºå®šçš„ï¼Œåˆ™ï¼š
$$
\begin{aligned}w_j^\ast &= -\frac{G_j}{H_j+\lambda}\\
\text{obj}^\ast &= -\frac{1}{2} \sum_{j=1}^T \frac{G_j^2}{H_j+\lambda} + \gamma T\end{aligned}$$

ç†è®ºä¸Šåº”è¯¥éå†æ‰€æœ‰çš„æ ‘ç»“æ„åˆ†åˆ«ç®—å‡ºæŸå¤±ï¼Œå¹¶æ‰¾åˆ°å¯¹åº”æŸå¤±æœ€å°çš„æ ‘çš„ç»“æ„ï¼Œå®é™…ä¸Šæ ‘çš„ç»“æ„æ²¡æ³•å…¨éƒ¨ç©·ä¸¾ï¼Œå› æ­¤ä½¿ç”¨è´ªå¿ƒç®—æ³•ï¼Œå¹¶ä¸èƒ½ä¿è¯å…¨å±€æœ€ä¼˜ï¼Œå®šä¹‰åˆ†è£‚çš„Gainä¸ºï¼š
$$Gain = \frac{1}{2} \left[\frac{G_L^2}{H_L+\lambda}+\frac{G_R^2}{H_R+\lambda}-\frac{(G_L+G_R)^2}{H_L+H_R+\lambda}\right] - \gamma$$

å…¶å®å°±æ˜¯åˆ†è£‚å‰çš„losså‡å»åˆ†è£‚åçš„lossï¼Œä»æ‰€æœ‰çš„åˆ†è£‚æ–¹å¼ä¸­é€‰æ‹©Gainæœ€å¤§çš„é‚£ä¸ªï¼Œå¦‚æœæœ€å¤§çš„Gainæ˜¯å°äºé›¶çš„ï¼Œå°±å¯ä»¥åœæ­¢åˆ†è£‚äº†ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ†è£‚å‡å°‘çš„è¯¯å·®è¿˜ä¸è¶³ä»¥å¼¥è¡¥æ¨¡å‹å˜å¤æ‚å¸¦æ¥çš„æŸå¤±ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦åœ¨åˆ†è£‚ä¸‹å»äº†ã€‚
